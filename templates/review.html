{% extends 'base.html' %}
{% block title %}Review CV - CVLatex{% endblock %}
{% block extra_head %}
{% endblock %}
{% block content %}

    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title">ðŸ“Š CV Review Results</h1>
            <p class="page-subtitle">Comprehensive analysis of your resume with actionable insights</p>
        </div>

        <div class="block score-block" id="score">
            <div class="score-circle" id="scoreCircle">
                <span id="scoreValue">{{ review_data.rating or 0 }}</span>
            </div>
            <div class="score-label">Overall Score</div>
            <div class="score-description">Out of 100 points</div>
        </div>

        <div class="content-grid">
            <div class="block content-block" id="strengths">
                <div class="block-header">
                    <div class="block-icon strengths-icon">
                        <i class="fas fa-thumbs-up"></i>
                    </div>
                    <h3 class="block-title">Strengths</h3>
                </div>
                <ul class="list">
                    {% for strength in review_data.strengths %}
                    <li class="list-item">
                        <div class="list-bullet strength-bullet"></div>
                        <span>{{ strength }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="block content-block" id="weaknesses">
                <div class="block-header">
                    <div class="block-icon weaknesses-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3 class="block-title">Areas for Improvement</h3>
                </div>
                <ul class="list">
                    {% for weakness in review_data.weaknesses %}
                    <li class="list-item">
                        <div class="list-bullet weakness-bullet"></div>
                        <span>{{ weakness }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="block content-block" id="suggestions">
                <div class="block-header">
                    <div class="block-icon suggestions-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h3 class="block-title">Suggestions</h3>
                </div>
                <ul class="list">
                    {% for suggestion in review_data.suggestions %}
                    <li class="list-item">
                        <div class="list-bullet suggestion-bullet"></div>
                        <span>{{ suggestion }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="block action-block" id="actions">
            <h2 class="action-title">âœ¨ Ready to Improve Your CV?</h2>
            <p class="action-description">
                Generate an enhanced version of your resume based on our analysis and recommendations.
            </p>
            <div class="buttons">
                <button class="button button-primary" onclick="generateImprovedResume()">
                    <i class="fas fa-magic"></i>
                    Generate Improved Resume
                </button>
                <a href="/upload" class="button button-secondary">
                    <i class="fas fa-upload"></i>
                    Upload New CV
                </a>
                <a href="/" class="button button-secondary">
                    <i class="fas fa-home"></i>
                    Back to Home
                </a>
            </div>
        </div>

        <div class="block loading-block" id="loadingBlock">
            <div class="loading-spinner"></div>
            <p class="loading-text">Generating your improved resume...</p>
        </div>
    </div>

{% endblock %}
{% block extra_scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreValue = parseInt(document.getElementById('scoreValue').textContent);
            
            if (scoreValue >= 80) {
                scoreCircle.classList.add('score-excellent');
            } else if (scoreValue >= 60) {
                scoreCircle.classList.add('score-good');
            } else if (scoreValue >= 40) {
                scoreCircle.classList.add('score-average');
            } else {
                scoreCircle.classList.add('score-poor');
            }
        });
        
        async function generateImprovedResume() {
            const generateBtn = document.querySelector('.button-primary');
            const loadingBlock = document.getElementById('loadingBlock');
            const originalText = generateBtn.innerHTML;
            
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
            generateBtn.disabled = true;
            loadingBlock.style.display = 'block';
            
            try {
                const response = await fetch('/api/generate-improved-resume', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        window.location.href = `/improved-resume-preview/${result.session_id}`;
                    } else {
                        alert('Error: ' + (result.error || 'Failed to generate improved resume'));
                    }
                } else {
                    const errorData = await response.json();
                    if (errorData.redirect) {
                        alert('Error: ' + (errorData.error || 'Failed to generate improved resume'));
                        window.location.href = errorData.redirect;
                    } else {
                        alert('Error: ' + (errorData.error || 'Failed to generate improved resume'));
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error generating improved resume. Please try again.');
            } finally {
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
                loadingBlock.style.display = 'none';
            }
        }
    </script>
{% endblock %}
